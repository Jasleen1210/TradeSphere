<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeSphere 1 - User Profile</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nav.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
   
    <section>
        <header class="navig">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo">
                <h1>TradeSphere</h1>
            </div>
            <nav>
                <ul class="navbar">
                    <li><a href="{{ url_for('index') }}">Home</a></li>
                    <li><a href="{{ url_for('about') }}">About</a></li>
                    <li><a href="{{ url_for('trade') }}">Trade</a></li>
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-link">Markets</a>
                        <ul class="dropdown-menu">
                            <li><a href="{{ url_for('solar') }}">Solar</a></li>
                            <li><a href="{{ url_for('wind') }}">Wind</a></li>
                            <li><a href="{{ url_for('biogas') }}">Biogas</a></li>
                        </ul>
                    </li>
                    <li><a href="{{ url_for('login') }}">Login</a></li>
                </ul>
            </nav>
        </header>
    
        <div class="container">
            <main>
                <div class="profile-container">
                    <h2>User Profile</h2>
    
                    <div class="profile-details">
                        <h3>Profile Details</h3>
                        <p><strong>Name:</strong> {{ profile.profileName }}</p>
                        <p><strong>Username:</strong> {{ profile.userName }}</p>
                        <p><strong>Email:</strong> {{ profile.userEmail }}</p>
                        <p><strong>Bio:</strong> {{ profile.profileBio }}</p>
                        <p><strong>Location:</strong> {{ profile.profileLocation }}</p>
                        <p><strong>No. of RECs:</strong> {{ profile.profileRECs }}</p>
                        <p><strong>Watt Quantity:</strong> {{ profile.profileWatt }}</p>
                        <p><strong>Energies Traded:</strong> {{ profile.profileEnergy }}</p>

    
                        <a href="{{ url_for('edit') }}" class="btn">Edit Profile</a>
                        <div><a href="{{ url_for('footprint') }}" class="btn">Footprint Tracker</a></div>
                    </div>
                
                    <div class="wallet-container">
                        <h2>Paytm Wallet</h2>
                        <p><strong>Wallet Balance:</strong> <span id="walletBalance">0</span> INR</p>
                        <label for="walletAmount">Enter Amount:</label>
                        <input type="number" id="walletAmount" placeholder="Enter amount" min="1">
                        <button id="useWallet" class="btn">Use Wallet</button>
                        <button id="addMoney" class="btn secondary">Add Money</button>
                    </div>
                <div class="order-container">
                    <h2>Your Orders</h2>
                    <button id="filterBtn">Filter Orders</button>
                    <table class="orders-table" id="ordersTable">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Energy Type</th>
                                <th>Quantity (kWh)</th>
                                <th>Price (INR)</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>#ORD12345</td><td>Solar</td><td>150</td><td>3000</td><td>Completed</td></tr>
                            <tr><td>#ORD12346</td><td>Wind</td><td>200</td><td>4000</td><td>Pending</td></tr>
                            <tr><td>#ORD12347</td><td>Solar</td><td>50</td><td>1000</td><td>In Progress</td></tr>
                            <tr><td>#ORD12348</td><td>Biogas</td><td>100</td><td>2000</td><td>Cancelled</td></tr>
                            <tr><td>#ORD12349</td><td>Wind</td><td>300</td><td>6000</td><td>Completed</td></tr>
                            <tr><td>#ORD12350</td><td>Biogas</td><td>75</td><td>1500</td><td>Pending</td></tr>
                            <tr><td>#ORD12351</td><td>Solar</td><td>120</td><td>2500</td><td>Completed</td></tr>
                        </tbody>
                    </table>
                    <div class="chart-container">
                        <canvas id="ordersChart"></canvas>
                    </div>
                </div>
            </main>
        </div>
    
       
    
        <div id="filterModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>Filter Orders</h3>
    
                <div class="radio-group">
                    <h4>Energy Type:</h4>
                    <label><input type="checkbox" name="energyType" value="Solar"> Solar</label><br>
                    <label><input type="checkbox" name="energyType" value="Wind"> Wind</label><br>
                    <label><input type="checkbox" name="energyType" value="Biogas"> Biogas</label><br>
                    <label><input type="checkbox" name="energyType" value="All" checked> All</label>
                </div>
    
                <div class="radio-group">
                    <h4>Status:</h4>
                    <label><input type="checkbox" name="status" value="Completed"> Completed</label><br>
                    <label><input type="checkbox" name="status" value="Pending"> Pending</label><br>
                    <label><input type="checkbox" name="status" value="In Progress"> In Progress</label><br>
                    <label><input type="checkbox" name="status" value="Cancelled"> Cancelled</label><br>
                    <label><input type="checkbox" name="status" value="All" checked> All</label>
                </div>
    
                <button id="applyFilterBtn">Apply Filter</button>
            </div>
        </div>
    </section>

    <script>
         /*document.getElementById('profileName').textContent = localStorage.getItem('profileName') || 'Not set';
   
    document.getElementById('profileBio').textContent = localStorage.getItem('profileBio') || 'Not set';
    document.getElementById('profileLocation').textContent = localStorage.getItem('profileLocation') || 'Not set';
        // Get user data from localStorage
        const email = localStorage.getItem('userEmail');
        const userName = localStorage.getItem('userName'); // Retrieve the name (from email or other source)*/
    
        // Display the email and name in the profile section
        document.getElementById('userEmail').textContent = email;
        document.getElementById('userName').textContent = userName;
    
        function generateChart() {
            const table = document.getElementById('ordersTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            const statusCounts = {};
            const statusOrders = {};
            const totalOrders = rows.length;
            
            for (let row of rows) {
                let orderId = row.cells[0].innerText.trim();
                let status = row.cells[4].innerText.trim();
                
                statusCounts[status] = (statusCounts[status] || 0) + 1;
                if (!statusOrders[status]) {
                    statusOrders[status] = [];
                }
                statusOrders[status].push(orderId);
            }
            
            const labels = Object.keys(statusCounts);
            const data = Object.values(statusCounts);
            
            const ctx = document.getElementById('ordersChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: ['#36A2EB', '#FFCE56', '#FF6384', 'green'],
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    let label = tooltipItem.label || '';
                                    let count = tooltipItem.raw || 0;
                                    let percentage = ((count / totalOrders) * 100).toFixed(2);
                                    let orders = statusOrders[label] ? statusOrders[label] : ['No Orders'];
                                    return [`${label}: ${percentage}%`, 'Orders:'].concat(orders);
                                }
                            }
                        }
                    }
                }
            });
        }
    
        generateChart();
    
        // Modal functionality for filtering
        const filterModal = document.getElementById("filterModal");
        const filterBtn = document.getElementById("filterBtn");
        const closeModal = document.getElementsByClassName("close")[0];
        const applyFilterBtn = document.getElementById("applyFilterBtn");
    
        filterBtn.onclick = () => filterModal.style.display = "block"; // Open the modal
        closeModal.onclick = () => filterModal.style.display = "none"; // Close the modal
        window.onclick = (event) => {
            if (event.target == filterModal) {
                filterModal.style.display = "none"; // Close if clicking outside the modal
            }
        };
    
        // Filter function
        // Filter function using for and if logic
applyFilterBtn.onclick = () => {
    const energyTypes = [];
    const statuses = [];
    
    // Get selected energy types
    const energyTypeCheckboxes = document.querySelectorAll('input[name="energyType"]:checked');
    for (let checkbox of energyTypeCheckboxes) {
        energyTypes.push(checkbox.value);
    }
    
    // Get selected statuses
    const statusCheckboxes = document.querySelectorAll('input[name="status"]:checked');
    for (let checkbox of statusCheckboxes) {
        statuses.push(checkbox.value);
    }
    
    filterOrders(energyTypes, statuses);
    filterModal.style.display = "none"; // Close modal after filter
};

function filterOrders(energyTypes, statuses) {
    const table = document.getElementById('ordersTable');
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

    let filteredRows = [];

    for (let row of rows) {
        const rowEnergyType = row.cells[1].innerText.trim();
        const rowStatus = row.cells[4].innerText.trim();

        let matchEnergyType = false;
        let matchStatus = false;

        // Check if the row matches any selected energy type
        if (energyTypes.includes('All') || energyTypes.includes(rowEnergyType)) {
            matchEnergyType = true;
        }

        // Check if the row matches any selected status
        if (statuses.includes('All') || statuses.includes(rowStatus)) {
            matchStatus = true;
        }

        // If both energy type and status match, add the row to filteredRows
        if (matchEnergyType && matchStatus) {
            filteredRows.push(row);
        } else {
            row.style.display = 'none'; // Hide non-matching rows
        }
    }

    // Show only the filtered rows
    for (let row of rows) {
        if (!filteredRows.includes(row)) {
            row.style.display = 'none'; // Hide the rows not in filteredRows
        } else {
            row.style.display = ''; // Show the filtered rows
        }
    }

    // After filtering, regenerate the chart with updated data
    generateChart();
}
document.getElementById("useWallet").addEventListener("click", function () {
    let amount = parseInt(document.getElementById("walletAmount").value);

    if (isNaN(amount) || amount <= 0) {
        alert("Please enter a valid amount to use from the wallet.");
        return;
    }

    let walletBalance = parseInt(localStorage.getItem("walletBalance")) || 0;

    if (amount > walletBalance) {
        alert("Insufficient wallet balance!");
        return;
    }

    // Deduct the amount from the wallet
    walletBalance -= amount;
    localStorage.setItem("walletBalance", walletBalance);
    document.getElementById("walletBalance").textContent = walletBalance + " INR";

    // Store transaction amount for payment page
    localStorage.setItem("walletTransactionAmount", amount);

    // Redirect to payment.html
    window.location.href = "payment.html";
});
(function(){
            if(!window.chatbase || window.chatbase("getState") !== "initialized"){
                window.chatbase = (...arguments) => {
                    if(!window.chatbase.q) { window.chatbase.q = []; }
                    window.chatbase.q.push(arguments);
                };
                window.chatbase = new Proxy(window.chatbase, {
                    get(target, prop) {
                        if (prop === "q") { return target.q; }
                        return (...args) => target(prop, ...args);
                    }
                });
            }
            const onLoad = function() {
                const script = document.createElement("script");
                script.src = "https://www.chatbase.co/embed.min.js";
                script.id = "qjVoHtpT94gDHkc3Ioe3L";
                script.domain = "www.chatbase.co";
                document.body.appendChild(script);
            };
            if (document.readyState === "complete") {
                onLoad();
            } else {
                window.addEventListener("load", onLoad);
            }
        })();

    </script>
        
</body>
</html>
